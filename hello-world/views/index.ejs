<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <video autoplay muted loop id="backgroundVideo">
      <source src="/videos/background.mp4" type="video/mp4">
    </video>
    <h1><%= title %></h1>
    <div class="container">
      <div class="title">
        Message: <p id="message"><%= message %></p>
      </div>
      <div class="subtitle">
        Block number: <p id="blockNumber"><%= blockNumber %></p>
      </div>
      <div class="frame">
        <div class="title">
          Update Message
        </div>
        <div class="contents">
          Sender : <select id="selSender">
            <% for(let i = 0; i < accounts.length; i++) { %>
              <option value="<%= i %>"><%= accounts[i] %></option>
            <% } %>
          </select>
          <input type="text" id="inputMessage" class="input-box" placeholder="Hi">
          <div>
            <button id="btnUpdateMessage">Send</button>
          </div>
        </div>
      </div>
    </div>
    <!-- javascript -->
    <script>
      document.getElementById("btnUpdateMessage").addEventListener('click', event => {
        const selSender = document.getElementById("selSender");
        const sender = selSender.options[selSender.selectedIndex].text;
        const newMessage = document.getElementById("inputMessage").value;
        const message = document.getElementById("message");
        const blockNumber = document.getElementById("blockNumber");

        // 서버로 post 요청 보내기
        fetch("/message", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ sender, newMessage })
        })
        .then(response => response.json())
        .then(json => {
          message.innerHTML = json.message;
          blockNumber.innerHTML = json.blockNumber;
        });
      });
    </script>
  </body>
</html>
